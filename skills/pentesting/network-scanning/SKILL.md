---
name: network-scanning
description: |
  Network discovery, port scanning, and service enumeration for penetration testing.
  Identify live hosts, open ports, running services, and potential vulnerabilities.
  Use for network reconnaissance and vulnerability assessment phases.
license: Apache-2.0
compatibility: |
  - Python 3.9+
  - Optional: nmap integration, scapy
metadata:
  author: SherifEldeeb
  version: "1.0.0"
  category: pentesting
---

# Network Scanning Skill

Comprehensive network discovery and scanning capabilities for authorized penetration testing engagements.

## Capabilities

- **Host Discovery**: Identify live hosts on networks
- **Port Scanning**: TCP/UDP port scanning with various techniques
- **Service Detection**: Identify services and versions
- **OS Fingerprinting**: Identify operating systems
- **Vulnerability Scanning**: Basic vulnerability detection
- **Network Mapping**: Visualize network topology
- **Scan Orchestration**: Manage and schedule scans

## Quick Start

```python
from network_scan_utils import PortScanner, HostDiscovery, ServiceDetector

# Discover live hosts
discovery = HostDiscovery('192.168.1.0/24')
hosts = discovery.ping_sweep()
print(f"Live hosts: {hosts}")

# Port scan
scanner = PortScanner('192.168.1.100')
scanner.tcp_scan(ports='1-1000')
print(scanner.get_results())

# Service detection
detector = ServiceDetector('192.168.1.100')
services = detector.detect_services([22, 80, 443])
print(services)
```

## Usage

### Host Discovery

Identify live hosts on a network.

**Example**:
```python
from network_scan_utils import HostDiscovery

discovery = HostDiscovery('192.168.1.0/24')

# ICMP ping sweep
live_hosts = discovery.ping_sweep()
print(f"Hosts responding to ICMP: {live_hosts}")

# ARP discovery (local network)
arp_hosts = discovery.arp_discovery()
print(f"Hosts found via ARP: {arp_hosts}")

# TCP SYN discovery
syn_hosts = discovery.tcp_syn_discovery(ports=[22, 80, 443])
print(f"Hosts with open ports: {syn_hosts}")

# Combined discovery
all_hosts = discovery.full_discovery()
print(f"All discovered hosts: {all_hosts}")

# Export results
discovery.export_hosts('live_hosts.txt')
```

### Port Scanning

Scan ports using various techniques.

**Example**:
```python
from network_scan_utils import PortScanner

scanner = PortScanner('192.168.1.100')

# TCP SYN scan (fast)
scanner.tcp_syn_scan(ports='1-1000')

# TCP connect scan
scanner.tcp_connect_scan(ports='1-65535')

# UDP scan
scanner.udp_scan(ports='53,67,68,123,161,162,500')

# Common ports scan
scanner.common_ports_scan()

# Custom port list
scanner.tcp_scan(ports=[22, 80, 443, 8080, 8443])

# Get results
results = scanner.get_results()
for port in results['open_ports']:
    print(f"Port {port['port']}/{port['protocol']}: {port['state']}")

# Export
scanner.export_results('scan_results.json')
scanner.export_nmap_format('scan.nmap')
```

### Service Detection

Identify services running on open ports.

**Example**:
```python
from network_scan_utils import ServiceDetector

detector = ServiceDetector('192.168.1.100')

# Detect services on specific ports
services = detector.detect_services([22, 80, 443, 3306])

for service in services:
    print(f"Port {service['port']}: {service['service']} {service['version']}")
    print(f"  Banner: {service['banner']}")

# Grab banners
banners = detector.grab_banners([21, 22, 25, 80])
for port, banner in banners.items():
    print(f"Port {port}: {banner}")

# HTTP service detection
http_info = detector.detect_http(80)
print(f"Server: {http_info['server']}")
print(f"Title: {http_info['title']}")
print(f"Technologies: {http_info['technologies']}")

# SSL/TLS service detection
ssl_info = detector.detect_ssl(443)
print(f"SSL Version: {ssl_info['version']}")
print(f"Certificate: {ssl_info['certificate']}")
print(f"Cipher: {ssl_info['cipher']}")
```

### OS Fingerprinting

Identify operating systems.

**Example**:
```python
from network_scan_utils import OSFingerprinter

fingerprinter = OSFingerprinter('192.168.1.100')

# TCP/IP stack fingerprinting
os_info = fingerprinter.fingerprint()
print(f"OS: {os_info['os']}")
print(f"Confidence: {os_info['confidence']}%")
print(f"Details: {os_info['details']}")

# TTL-based detection
ttl_os = fingerprinter.ttl_analysis()
print(f"TTL suggests: {ttl_os}")

# Service-based inference
service_os = fingerprinter.service_inference()
print(f"Services suggest: {service_os}")
```

### Vulnerability Scanning

Basic vulnerability detection.

**Example**:
```python
from network_scan_utils import VulnScanner

vuln_scanner = VulnScanner('192.168.1.100')

# Scan for common vulnerabilities
vulns = vuln_scanner.scan_common_vulns()
for vuln in vulns:
    print(f"Port {vuln['port']}: {vuln['vulnerability']}")
    print(f"  Severity: {vuln['severity']}")
    print(f"  CVE: {vuln['cve']}")

# Check specific vulnerabilities
smb_vulns = vuln_scanner.check_smb_vulns()
ssl_vulns = vuln_scanner.check_ssl_vulns()
http_vulns = vuln_scanner.check_http_vulns()

# Default credentials check
defaults = vuln_scanner.check_default_credentials([22, 23, 3306, 5432])
for result in defaults:
    print(f"Port {result['port']}: {result['status']}")

# Generate vulnerability report
report = vuln_scanner.generate_report()
print(report)
```

### Network Mapping

Visualize network topology.

**Example**:
```python
from network_scan_utils import NetworkMapper

mapper = NetworkMapper()

# Scan network
mapper.scan_network('192.168.1.0/24')

# Add discovered hosts
for host in discovered_hosts:
    mapper.add_host(host['ip'], host['hostname'], host['os'])

# Add connections
mapper.add_connection('192.168.1.1', '192.168.1.100', 'Gateway')
mapper.add_connection('192.168.1.100', '192.168.1.101', 'Peer')

# Detect network segments
segments = mapper.detect_segments()
print(f"Segments: {segments}")

# Generate map
mapper.generate_topology_map('network_map.json')
mapper.generate_visual_map('network_map.html')
```

### Scan Scheduling

Schedule and manage scans.

**Example**:
```python
from network_scan_utils import ScanScheduler

scheduler = ScanScheduler()

# Create scan job
job = scheduler.create_job(
    name='Weekly Network Scan',
    targets=['192.168.1.0/24'],
    scan_type='full',
    schedule='weekly'
)

# Add scan profile
scheduler.add_profile(
    name='Quick Scan',
    ports='1-1000',
    techniques=['syn'],
    service_detection=True
)

# Run scan with profile
results = scheduler.run_scan('192.168.1.100', profile='Quick Scan')

# Compare scans
diff = scheduler.compare_scans('scan_001', 'scan_002')
print(f"New hosts: {diff['new_hosts']}")
print(f"New ports: {diff['new_ports']}")
print(f"Closed ports: {diff['closed_ports']}")
```

## Configuration

### Environment Variables

| Variable | Description | Required | Default |
|----------|-------------|----------|---------|
| `SCAN_TIMEOUT` | Timeout per port in seconds | No | `2` |
| `SCAN_RATE` | Packets per second | No | `1000` |
| `SCAN_RETRIES` | Number of retries | No | `2` |
| `NMAP_PATH` | Path to nmap binary | No | Auto-detect |

### Options

| Option | Type | Description |
|--------|------|-------------|
| `stealth` | bool | Use stealthy scanning techniques |
| `aggressive` | bool | Enable aggressive scanning |
| `randomize` | bool | Randomize target/port order |
| `fragment` | bool | Fragment packets |

## Examples

### Example 1: Full Network Assessment

**Scenario**: Complete network scan for penetration test

**Input**:
```python
from network_scan_utils import NetworkAssessment

assessment = NetworkAssessment('192.168.1.0/24')
assessment.run_full_assessment()
```

**Output**:
```
# Network Assessment Report

## Executive Summary
- Network: 192.168.1.0/24
- Live hosts: 45
- Total open ports: 127
- Critical findings: 3

## Live Hosts
| IP | Hostname | OS | Open Ports |
|----|----------|-------|------------|
| 192.168.1.1 | gateway | Linux | 22,80,443 |
| 192.168.1.10 | web01 | Ubuntu | 22,80,443,3306 |
| 192.168.1.20 | dc01 | Windows | 53,88,135,389,445 |

## Critical Findings
1. SMBv1 enabled on 192.168.1.20 (MS17-010)
2. Default credentials on 192.168.1.15:22
3. Exposed database on 192.168.1.10:3306
```

### Example 2: Stealth Scan

**Scenario**: Minimally invasive scan for sensitive environment

**Input**:
```python
scanner = PortScanner('10.0.0.100', stealth=True)
scanner.tcp_syn_scan(ports='1-1000', rate=10)
```

**Output**:
```
Scan completed in 210 seconds
Open ports: 22, 80, 443
No IDS alerts triggered
```

## Limitations

- **Root/Admin Required**: Some scan types require elevated privileges
- **Firewall Evasion**: Basic evasion techniques only
- **Accuracy**: Results may vary based on network conditions
- **Legal**: Scanning requires explicit authorization

## Troubleshooting

### Permission Denied

**Problem**: SYN scan requires root/admin privileges

**Solution**: Use TCP connect scan or run with elevated privileges:
```python
scanner.tcp_connect_scan(ports='1-1000')  # No root needed
```

### Slow Scans

**Problem**: Scans taking too long

**Solution**: Adjust timing:
```python
scanner = PortScanner('target', timeout=1, rate=5000)
```

## Related Skills

- [reconnaissance](../reconnaissance/): Information gathering
- [exploitation](../exploitation/): Exploit identified services
- [vulnerability-management](../../cybersecurity/vulnerability-management/): Track vulnerabilities
- [pentest-reporting](../pentest-reporting/): Document findings

## References

- [Detailed API Reference](references/REFERENCE.md)
- [Nmap Reference Guide](https://nmap.org/book/man.html)
- [Port Scanning Techniques](https://nmap.org/book/man-port-scanning-techniques.html)

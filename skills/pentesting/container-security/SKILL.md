---
name: container-security
description: |
  Container and Kubernetes security testing. Docker, Kubernetes, and cloud
  container security assessment. Escape techniques and misconfigurations.
  Use for container security assessments.
license: Apache-2.0
compatibility: |
  - Python 3.9+
  - Optional: docker, kubernetes client
metadata:
  author: SherifEldeeb
  version: "1.0.0"
  category: pentesting
---

# Container Security Skill

Container and orchestration security testing for Docker and Kubernetes.

## Capabilities

- **Docker Security**: Image analysis, runtime security
- **Kubernetes Security**: Cluster security, RBAC, secrets
- **Container Escape**: Breakout techniques
- **Image Analysis**: Vulnerability scanning, secrets
- **Registry Security**: Container registry testing
- **Network Policies**: Container network analysis

## Quick Start

```python
from container_utils import DockerAnalyzer, KubernetesAssessor, ImageScanner

# Docker analysis
docker = DockerAnalyzer()
containers = docker.list_containers()
findings = docker.analyze_security()

# Kubernetes assessment
k8s = KubernetesAssessor()
findings = k8s.assess_cluster()

# Image scanning
scanner = ImageScanner('nginx:latest')
vulns = scanner.scan()
```

## Usage

### Docker Security Analysis

Analyze Docker security configuration.

**Example**:
```python
from container_utils import DockerAnalyzer

docker = DockerAnalyzer()

# List containers
containers = docker.list_containers()
for c in containers:
    print(f"{c['name']}: {c['image']}")

# Analyze container security
for container in containers:
    analysis = docker.analyze_container(container['id'])
    print(f"Privileged: {analysis['privileged']}")
    print(f"Capabilities: {analysis['capabilities']}")
    print(f"Mounts: {analysis['sensitive_mounts']}")
    print(f"Network mode: {analysis['network_mode']}")

# Check Docker daemon
daemon = docker.analyze_daemon()
print(f"Root user: {daemon['root_user']}")
print(f"TLS enabled: {daemon['tls']}")
print(f"Exposed socket: {daemon['exposed_socket']}")

# Find escape opportunities
escape = docker.find_escape_opportunities()
for opp in escape:
    print(f"Escape: {opp['technique']} - {opp['requirements']}")

# Analyze docker-compose
compose = docker.analyze_compose('docker-compose.yml')

# Export findings
docker.export_report('docker_security.json')
```

### Kubernetes Security Assessment

Assess Kubernetes cluster security.

**Example**:
```python
from container_utils import KubernetesAssessor

k8s = KubernetesAssessor(kubeconfig='~/.kube/config')

# Cluster info
info = k8s.get_cluster_info()
print(f"Version: {info['version']}")
print(f"Nodes: {info['node_count']}")

# RBAC analysis
rbac = k8s.analyze_rbac()
print(f"Cluster admins: {rbac['cluster_admins']}")
print(f"Overprivileged SAs: {rbac['overprivileged_service_accounts']}")

# Pod security
pods = k8s.analyze_pod_security()
for pod in pods['insecure']:
    print(f"Insecure pod: {pod['name']} - {pod['issues']}")

# Secrets analysis
secrets = k8s.analyze_secrets()
print(f"Unencrypted secrets: {secrets['unencrypted']}")
print(f"Exposed secrets: {secrets['exposed']}")

# Network policies
network = k8s.analyze_network_policies()
print(f"Namespaces without policies: {network['no_policies']}")

# API server security
api = k8s.analyze_api_server()
print(f"Anonymous auth: {api['anonymous_auth']}")
print(f"RBAC enabled: {api['rbac_enabled']}")

# Full assessment
findings = k8s.assess_cluster()
k8s.export_report('k8s_security.json')
```

### Container Escape

Test container escape techniques.

**Example**:
```python
from container_utils import ContainerEscape

escape = ContainerEscape()

# Check escape vectors
vectors = escape.enumerate_vectors()
for v in vectors:
    print(f"Vector: {v['name']}")
    print(f"  Exploitable: {v['exploitable']}")
    print(f"  Technique: {v['technique']}")

# Check for mounted docker socket
if escape.check_docker_socket():
    escape.escape_via_docker_socket()

# Check for privileged mode
if escape.check_privileged():
    escape.escape_via_privileged()

# Check capabilities
caps = escape.check_capabilities()
if 'CAP_SYS_ADMIN' in caps:
    escape.escape_via_cap_sys_admin()

# Check for sensitive mounts
mounts = escape.check_sensitive_mounts()
```

### Image Security Scanning

Scan container images for vulnerabilities.

**Example**:
```python
from container_utils import ImageScanner

scanner = ImageScanner('nginx:latest')

# Scan for vulnerabilities
vulns = scanner.scan_vulnerabilities()
print(f"Critical: {vulns['critical']}")
print(f"High: {vulns['high']}")
print(f"Medium: {vulns['medium']}")

for vuln in vulns['findings']:
    print(f"{vuln['cve']}: {vuln['package']} - {vuln['severity']}")

# Scan for secrets
secrets = scanner.scan_secrets()
for secret in secrets:
    print(f"Secret: {secret['type']} in {secret['path']}")

# Analyze layers
layers = scanner.analyze_layers()

# Check base image
base = scanner.check_base_image()
print(f"Base image: {base['image']}")
print(f"Up to date: {base['up_to_date']}")

# Generate SBOM
sbom = scanner.generate_sbom()
scanner.export_sbom('sbom.json')
```

## Configuration

### Environment Variables

| Variable | Description | Required | Default |
|----------|-------------|----------|---------|
| `KUBECONFIG` | Kubernetes config path | No | `~/.kube/config` |
| `DOCKER_HOST` | Docker daemon socket | No | Auto-detect |

## Limitations

- **Access Required**: Requires cluster/daemon access
- **Permissions**: Some tests need elevated permissions
- **Detection**: Activities may be logged

## Related Skills

- [cloud-security-testing](../cloud-security-testing/): Cloud container services
- [post-exploitation](../post-exploitation/): Container escape
- [pentest-reporting](../pentest-reporting/): Document findings

## References

- [CIS Docker Benchmark](https://www.cisecurity.org/benchmark/docker)
- [CIS Kubernetes Benchmark](https://www.cisecurity.org/benchmark/kubernetes)
- [OWASP Container Security](https://cheatsheetseries.owasp.org/cheatsheets/Docker_Security_Cheat_Sheet.html)

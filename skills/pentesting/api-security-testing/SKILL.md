---
name: api-security-testing
description: |
  API security testing for REST, GraphQL, and SOAP APIs. Test authentication,
  authorization, injection, and API-specific vulnerabilities.
  Use for API penetration testing and security assessments.
license: Apache-2.0
compatibility: |
  - Python 3.9+
  - Optional: requests, graphql-core
metadata:
  author: SherifEldeeb
  version: "1.0.0"
  category: pentesting
---

# API Security Testing Skill

Comprehensive API security testing for REST, GraphQL, SOAP, and gRPC APIs.

## Capabilities

- **REST API Testing**: Endpoint discovery, parameter fuzzing, method testing
- **GraphQL Testing**: Introspection, query injection, DoS testing
- **Authentication Testing**: JWT, OAuth, API keys, bearer tokens
- **Authorization Testing**: BOLA, BFLA, function-level access
- **Rate Limiting**: Bypass techniques, throttling analysis
- **Data Exposure**: Excessive data, sensitive information
- **Mass Assignment**: Object property manipulation
- **Injection Testing**: NoSQL, command, template injection

## Quick Start

```python
from api_utils import APIScanner, RESTTester, GraphQLTester

# REST API testing
rest = RESTTester('https://api.target.com/v1')
rest.discover_endpoints()
rest.test_authentication()
rest.test_authorization()

# GraphQL testing
graphql = GraphQLTester('https://api.target.com/graphql')
graphql.introspect()
graphql.test_injection()
```

## Usage

### REST API Discovery

Discover and map API endpoints.

**Example**:
```python
from api_utils import APIScanner

scanner = APIScanner('https://api.target.com')

# Discover endpoints
endpoints = scanner.discover_endpoints()
for endpoint in endpoints:
    print(f"{endpoint['method']} {endpoint['path']}")
    print(f"  Parameters: {endpoint['params']}")

# Parse OpenAPI/Swagger spec
scanner.parse_openapi('/api/docs/openapi.json')

# Fuzz for hidden endpoints
hidden = scanner.fuzz_endpoints([
    '/api/v1/admin',
    '/api/v2/users',
    '/api/internal/debug'
])

# Detect API version
versions = scanner.detect_versions()
print(f"API versions: {versions}")

# Generate endpoint map
scanner.export_map('api_map.json')
```

### Authentication Testing

Test API authentication mechanisms.

**Example**:
```python
from api_utils import AuthTester

auth = AuthTester('https://api.target.com')

# Test JWT security
jwt_result = auth.test_jwt('/api/auth/login')
print(f"Algorithm: {jwt_result['algorithm']}")
print(f"None algorithm: {jwt_result['none_vuln']}")
print(f"Weak secret: {jwt_result['weak_secret']}")
print(f"Expiration: {jwt_result['exp_check']}")

# Test API key security
key_result = auth.test_api_key('/api/data', 'X-API-Key')
print(f"Key in URL: {key_result['key_in_url']}")
print(f"Key enumerable: {key_result['enumerable']}")

# Test OAuth flows
oauth_result = auth.test_oauth('/oauth/authorize')
print(f"PKCE required: {oauth_result['pkce']}")
print(f"State parameter: {oauth_result['state']}")
print(f"Redirect URI validation: {oauth_result['redirect_validation']}")

# Test bearer token
bearer_result = auth.test_bearer_token('/api/protected')
print(f"Token validated: {bearer_result['validated']}")
print(f"Token expiry: {bearer_result['expiry']}")

# Brute force protection
brute = auth.test_brute_force('/api/auth/login')
```

### BOLA/IDOR Testing

Test for Broken Object Level Authorization.

**Example**:
```python
from api_utils import BOLATester

bola = BOLATester('https://api.target.com')

# Set up user contexts
bola.add_user('user1', {'Authorization': 'Bearer token1'})
bola.add_user('user2', {'Authorization': 'Bearer token2'})

# Test for BOLA
result = bola.test_endpoint(
    '/api/users/{id}/profile',
    user='user1',
    id_param='id',
    test_ids=['1', '2', '3', '100', '999']
)
print(f"BOLA vulnerable: {result['vulnerable']}")
print(f"Accessible IDs: {result['accessible_ids']}")

# Test batch endpoints
batch = bola.test_batch_endpoint('/api/users/batch')

# Test with UUID guessing
uuid = bola.test_uuid_enumeration('/api/documents/{uuid}')

# Generate BOLA report
report = bola.generate_report()
```

### GraphQL Testing

Test GraphQL API security.

**Example**:
```python
from api_utils import GraphQLTester

gql = GraphQLTester('https://api.target.com/graphql')

# Introspection query
schema = gql.introspect()
print(f"Types: {schema['types']}")
print(f"Queries: {schema['queries']}")
print(f"Mutations: {schema['mutations']}")

# Test query injection
injection = gql.test_injection()
print(f"SQL injection: {injection['sqli']}")
print(f"NoSQL injection: {injection['nosqli']}")

# Test for DoS via complex queries
dos = gql.test_dos_query()
print(f"Depth limit: {dos['depth_limit']}")
print(f"Complexity limit: {dos['complexity_limit']}")
print(f"Batch limit: {dos['batch_limit']}")

# Test authorization
authz = gql.test_authorization()
print(f"Unauthorized access: {authz['issues']}")

# Dump schema
gql.export_schema('schema.graphql')

# Generate queries from schema
queries = gql.generate_test_queries()
```

### Rate Limiting Analysis

Test API rate limiting.

**Example**:
```python
from api_utils import RateLimitTester

rate = RateLimitTester('https://api.target.com')

# Test rate limits
limits = rate.test_limits('/api/search', requests=100)
print(f"Limit: {limits['requests_per_minute']}")
print(f"Headers: {limits['headers']}")

# Test bypass techniques
bypass = rate.test_bypass('/api/login')
print(f"IP rotation: {bypass['ip_rotation']}")
print(f"Header manipulation: {bypass['headers']}")
print(f"Case variation: {bypass['case_variation']}")

# Test per-user vs global limits
scope = rate.test_limit_scope('/api/data')
print(f"Limit scope: {scope['scope']}")
```

### Mass Assignment Testing

Test for mass assignment vulnerabilities.

**Example**:
```python
from api_utils import MassAssignmentTester

mass = MassAssignmentTester('https://api.target.com')

# Test endpoint
result = mass.test_endpoint(
    '/api/users/profile',
    method='PUT',
    original_data={'name': 'Test'},
    test_fields=['role', 'admin', 'isAdmin', 'permissions', 'balance']
)
print(f"Vulnerable: {result['vulnerable']}")
print(f"Assignable fields: {result['assignable']}")

# Auto-discover fields from response
discover = mass.discover_fields('/api/users/1')
print(f"Potential fields: {discover['fields']}")

# Test registration endpoint
reg = mass.test_registration('/api/auth/register')
```

### Data Exposure Testing

Test for excessive data exposure.

**Example**:
```python
from api_utils import DataExposureTester

exposure = DataExposureTester('https://api.target.com')

# Analyze response
result = exposure.analyze_response('/api/users/me')
print(f"Sensitive fields: {result['sensitive']}")
print(f"PII exposed: {result['pii']}")
print(f"Internal data: {result['internal']}")

# Compare user responses
compare = exposure.compare_responses(
    '/api/users/{id}',
    ids=['1', '2', '3']
)
print(f"Inconsistent fields: {compare['inconsistent']}")

# Test error responses
errors = exposure.test_error_exposure('/api/debug')
print(f"Stack traces: {errors['stack_traces']}")
print(f"Internal paths: {errors['paths']}")
```

## Configuration

### Environment Variables

| Variable | Description | Required | Default |
|----------|-------------|----------|---------|
| `API_TIMEOUT` | Request timeout | No | `30` |
| `API_RATE_LIMIT` | Requests per second | No | `10` |
| `API_PROXY` | Proxy URL | No | None |

### Options

| Option | Type | Description |
|--------|------|-------------|
| `auth_header` | str | Authorization header name |
| `content_type` | str | Default content type |
| `follow_redirects` | bool | Follow redirects |

## Examples

### Example 1: Full API Assessment

**Scenario**: Complete API security assessment

**Output**:
```
# API Security Assessment Report

## Authentication
- JWT none algorithm vulnerability found
- Weak secret detected (dictionary attack)

## Authorization (BOLA)
- /api/users/{id}/profile - IDOR vulnerable
- /api/orders/{id} - IDOR vulnerable

## Rate Limiting
- No rate limiting on /api/auth/login
- Bypass possible via X-Forwarded-For

## Data Exposure
- SSN exposed in /api/users/me
- Internal IDs in all responses
```

## Limitations

- **Dynamic Schemas**: May miss dynamically generated endpoints
- **Authentication**: Requires valid credentials for full testing
- **Rate Limits**: Testing may trigger protection mechanisms

## Related Skills

- [web-app-testing](../web-app-testing/): Web application testing
- [reconnaissance](../reconnaissance/): API discovery
- [pentest-reporting](../pentest-reporting/): Document findings

## References

- [OWASP API Security Top 10](https://owasp.org/www-project-api-security/)
- [API Security Checklist](https://github.com/shieldfy/API-Security-Checklist)
